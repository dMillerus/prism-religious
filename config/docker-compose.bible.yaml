services:
  bible-study:
    build:
      context: ./bible-study/ui
      dockerfile: docker/Dockerfile
      args:
        - VITE_PRISM_API_URL=http://localhost:8100
        - VITE_OLLAMA_API_URL=http://localhost:11434
    container_name: bible-study
    restart: unless-stopped
    ports:
      - "127.0.0.1:3003:3000"
    environment:
      - NODE_ENV=production
    networks:
      - aiml-net
    depends_on:
      prism:
        condition: service_healthy
      ollama:
        condition: service_started
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M
        reservations:
          memory: 128M

networks:
  aiml-net:
    external: true
    name: aiml-stack_aiml-net
